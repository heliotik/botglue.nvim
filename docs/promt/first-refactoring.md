помоги структурировать роуд мап по версии 0.2.0 плагина

вот мой не структурированный список мыслей

Мысли и идеи?

- дать контекст ко всему файлу а не только к части выделенного куска кода
- отдельное окно под тип задачи не имеет смысла. Проще дать список предыдущих запросов (fzf поиск по предыдущем запросам как в телескоп) или список избранных запросов (сортировка в списке по наиболее частому выбору) 
- нет возможности отменить длинный или корявый запрос (отбой по таймауту)
- нотификация в углу экрана не дает понимания что происходит нужно переделать на то как это работает в 99 (комент с лоадером снизу и сверху в коменте в скобках текст запроса)
- убрать история с анализом сосредоточиться на редактировании документа
- убрать надписи на русском в верхней части окна вместо этого туда написать botglue
- дать возможность выбрать модель что бы простые истории можно было пускать через более быструю модель (например хайку)
- подумать как можно дать больше контекста скилы из проекта, шорт команды типа /code-simplify, доступ к документации
- фаин тюнинг базовых промтов. сейчас промты максимально простые надо раскрыть их. иделально было бы подобрать скил к каждому типу. который бы динамически дополнялся бы в зависимости от проекта
- нужен дебаг процесса и подробные логи что происходит в клауд в момент выполнения промта
- при рефакторинге все повисает 

Что могл ло бы дать больше информации как улучшить плагин?

- https://code.claude.com/docs/en/cli-reference.md
- https://code.claude.com/docs/en/output-styles.md  
- https://code.claude.com/docs/en/headless.md
- https://code.claude.com/docs/en/best-practices.md
- https://code.claude.com/docs/en/skills.md

https://www.youtube.com/watch?v=MNvciiZ5x9A - подробный рассказ как рождалась идея 99 плагина у ThePrimeagen
https://www.youtube.com/watch?v=ws9zR-UzwTE - призентация плагина 99 ThePrimeagen


ключевое

- точно надо поправить как отображается прогресс. надо сделать как у прайма. не оконо нотификации а прям в коде добавлять плейсхолдер снизу и сверху чуть ниже что происходит и так что бы пользователь мог продолжать дальше работать с файлом. 

- надо упростить режимы до одного. вместо них настроить скилы для каждого типа задачи и что бы клауд код мог понять из контекста запроса что надо изменить и как и выбирал нужный скил

- нужно давать контекст не только куска который выделен но и всего файла и делать легкий ресерчь через агент эксплорер что бы лучше понимать что меняется в файле. цельный кусок текста или чать которая должна быть поправлена с пониманием контекста всего файла  

- нужно дать возможность выбора модели

- нужно дать история по ранее введеным промтам и поиск по ним через fzf (сортировака по частоте использования) 

- написать более мощьный мастер промт что бы он лучше матчился на проекто в котором запускается

---

Составь детальный роадмап для версии 0.2.0 плагина botglue.nvim. Результат оформи как markdown-документ `docs/plans/2026-02-06-v0.2.0-roadmap.md`.

## О проекте

**botglue.nvim** — Neovim-плагин для AI-редактирования текста через Claude Code CLI. Пользователь выделяет текст в visual mode, вводит инструкцию во всплывающем окне, получает результат (замена выделения или показ в окне).

**Текущая архитектура (v0.1.0, ~480 строк Lua):**

- `init.lua` — точка входа, `setup()`, 4 публичных метода: `optimize()`, `explain()`, `refactor()`, `translate()`
- `config.lua` — конфигурация (только `model` и `default_keymaps`)
- `operations.lua` — получение visual selection, оркестрация: selection → input → prompt → claude.call() → replace/window
- `ui.lua` — floating windows для ввода и результата, spinner через `nvim_echo` + `vim.uv.new_timer()`
- `claude.lua` — вызов `claude -p - --output-format text --model <model>` через `vim.fn.jobstart()`, 4 захардкоженных шаблона промтов на русском языке

**Текущие команды:** `:BotglueOptimize`, `:BotglueExplain`, `:BotglueRefactor`, `:BotglueTranslate`
**Кеймапы:** `<leader>po/pe/pr/pt` (visual mode)

**Вдохновение:** плагин [ThePrimeagen/99](https://github.com/ThePrimeagen/99) — inline-отображение прогресса через extmarks, единая точка входа, интеграция с AGENT.md.

## Проблемы текущей версии, которые нужно решить

### Критичные (P0)

1. **Прогресс непонятен.** `vim.notify` в углу экрана не даёт понимания, что происходит и где. Нужно inline-отображение через extmarks (virtual text) — как в 99: spinner + статус ниже выделения, текст запроса выше выделения. Пользователь должен продолжать работать с файлом во время ожидания.

2. **Нельзя отменить запрос.** Нет способа прервать долгий или ошибочный запрос. При рефакторинге всё зависает. Нужны: хранение `job_id`, функция `cancel()` через `vim.fn.jobstop()`, кеймап отмены, настраиваемый таймаут.

3. **4 отдельных режима избыточны.** Вместо жёстких команд optimize/explain/refactor/translate нужна единая команда `:Botglue` с одним окном ввода, где пользователь описывает намерение свободным текстом. Claude сам определяет тип задачи из контекста. Старые команды можно сохранить как алиасы.

### Важные (P1)

4. **Отправляется только выделенный фрагмент.** Claude не видит окружающий код — импорты, сигнатуры функций, структуру модуля. Нужно отправлять весь файл с маркерами `--- SELECTED REGION START/END ---`, чтобы Claude понимал контекст. Для больших файлов — окно ~500 строк вокруг выделения.

5. **Нет выбора модели.** Все запросы идут через opus, что медленно для простых задач. Нужна возможность выбрать модель: через конфиг (`model = "sonnet"`), через префикс в окне ввода (`!h упрости это` → haiku), через отдельный кеймап.

6. **Промты примитивные.** Текущие шаблоны — простой текст без учёта возможностей Claude Code. Нужен динамический system prompt через `--append-system-prompt`, который включает: имя проекта, путь к файлу, filetype, режим результата. В идеале — интеграция со skills (`.claude/skills/`), чтобы каждый тип задачи имел свой skill, адаптирующийся к проекту.

### Желательные (P2)

7. **Нет истории промтов.** Пользователи перенабирают одни и те же запросы. Нужна история в JSON-файле (`~/.local/share/nvim/botglue/history.json`) с поиском через telescope/fzf-lua, сортировкой по частоте использования.

8. **Нет отладки.** Когда что-то ломается, непонятно почему. Нужен модуль логирования: полный промт, CLI-команда со всеми флагами, stdout/stderr, тайминги, exit code. Команды `:BotglueLog` и `:BotglueLogClear`.

### Косметика (P3)

9. **UI-очистка.** Убрать все русские надписи в заголовках окон, заменить на `" botglue "`. Все UI-строки на английском.

10. **Streaming вывода (исследовательское).** Использовать `--output-format stream-json` для инкрементального отображения результата вместо ожидания полного ответа.

## Ресурсы для изучения перед составлением роадмапа

| Ресурс | Что важно |
|--------|-----------|
| [Claude Code CLI Reference](https://docs.anthropic.com/en/docs/claude-code/cli-usage) | Флаги: `--append-system-prompt`, `--allowedTools`, `--max-turns`, `--model` |
| [Claude Code Output Styles](https://docs.anthropic.com/en/docs/claude-code/cli-usage#output-format) | Формат `stream-json` для стриминга |
| [Claude Code Headless Mode](https://docs.anthropic.com/en/docs/claude-code/headless-mode) | Сессии (`--continue`, `--resume`), `input-format` |
| [Claude Code Best Practices](https://docs.anthropic.com/en/docs/claude-code/best-practices) | Управление контекстом, субагенты |
| [Claude Code Skills](https://docs.anthropic.com/en/docs/claude-code/skills) | Формат SKILL.md, автообнаружение, работа в `-p` mode |
| [ThePrimeagen/99 source](https://github.com/ThePrimeagen/99) | Модуль display (extmarks), lifecycle запроса, `stop_all_requests` |

## Требования к результату

1. **Формат:** Markdown-документ с приоритизированной матрицей (таблица), детальным описанием каждой фичи (проблема → решение → реализация), порядком реализации по фазам.
2. **Для каждой фичи:** конкретные API Neovim и Claude Code CLI, примеры кода, имена новых модулей/функций.
3. **Открытые вопросы:** Выдели отдельным разделом то, что требует исследования перед реализацией (например: работают ли skills в `-p` mode? Как `stream-json` взаимодействует с `jobstart`?).
4. **Порядок реализации:** Разбей на фазы (Phase 1: Foundation → Phase 2: Context & Quality → Phase 3: DX → Phase 4: Polish). Каждая фаза должна заканчиваться прохождением `make pr-ready`.

botglue.nvim/docs/plans/2026-02-06-v0.2.0-roadmap.md
botglue.nvim/docs/plans/2026-02-06-v0.2.0-design.md
botglue.nvim/docs/plans/2026-02-06-v0.2.0-implementation.md



